# test if nvm has been installed by the user desired
- stat:
      path: /home/yournonrootuser/.nvm
  register: nvm_path

- name: Setup NodeVersionManager and install node version
  become: yes
  # Execute config files such as .profile (Ansible uses non-interactive login shells)
  become_flags: -i 
  become_user: yournonrootuser 
  block:
    - name: Install nvm
      shell: >
        curl -o- https://raw.githubusercontent.com/creationix/nvm/master/install.sh | bash 
      args:
        executable: /bin/bash
        chdir: "$HOME"
        creates: "$HOME/.nvm/nvm.sh"

    - name: Setup .profile of yournonrootuser
      lineinfile:
        path: ~/.profile
        # This will make sure Node is on the users PATH
        line: source ~/.nvm/nvm.sh 
        create: yes
      become_flags: -i  
  when: nvm_path.stat.exists  == false 

  # if we got here we already know node version manager is installed
- name: installing node versions using loop
  command: sudo -iu yournonrootuser nvm install {{item}}
  args:
    executable: /bin/bash
    chdir: "$HOME"
    creates: "$HOME/.nvm/versions/node/v{{item}}"
  loop:
    - 14.18.3
